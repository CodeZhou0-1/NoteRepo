## Linux学习笔记

### 初始学习阶段

- **关于安装CentOS虚拟机的网络方面**

![image-20211202141020582](http://img.codezhou.com/img/image-20211202141020582.png)

- Linux的**目录文件结构**（一切皆文件）

![image-20211202150528554](http://img.codezhou.com/img/image-20211202150528554.png)



- **目录用途**
  - `/bin：` 是Binary的缩写，这个目录存放着最经常使用的命令。
  - `/home：`存放普通用户的主目录，在Linux中每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。
  - `/root：`该目录为系统管理员，也称作超级权限者的用户主目录。
  - `/usr/local`：这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似与windows下的program files目录。
  - `/boot：`存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。
  - `/media：`linux系统会自动识别一些设备，例如U盘光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。
  - `/mnt：`系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将外部的存储挂载在/mnt/上，然后进入该目录就可以查看里面的内容了。
  - `/opt：`这是给主机额外安装软件所摆放的目录，如安装ORACLE数据库就可放到该目录下。默认为空。
  - `/var：`这个目录中存放着在不断扩充着的东西，习惯将经常被修改的目录放在这个目录下，包括各种日志文件。
  - /sbin：s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。
  - /lib：系统开机所需要最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。
  - /lost+found：这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。
  - /etc：所有的系统管理所需要的配置文件和子目录my.conf。
  - /proc：这个目录是一个虚拟的目录，它是系统内存的映射，访问这个目录来获取系统信息。
  - /srv：service的缩写，该目录存放一些服务启动之后需要提供的数据。
  - /sys：这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统sysfs。
  - /tmp：这个目录是用来存放一些临时文件的。
  - /dev：类似windows的设备管理器，把所有的硬件用文件的形式存储。
  - /usr/local：这是另一个给主机额外安装软件所安装的目录，一般是通过编译源码的方式安装的程序。
  - /selinux：SELinux是一种安全子系统，它能控制程序只能访问特定文件。



### Linux实操

#### vi和vim编辑器

- 基本介绍
  - 所有Linux系统都会内置vi文本编辑器
  - vim是vi的升级版，可以主动以字体颜色分辨语法的正确性，代码补完和编译，错误跳转等功能。
- vi和vim的三种模式转换

![3.2vim模式转换.jpg](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/raw/master/imgs/3/3.2vim模式转换.jpg)

- Vim 的常见指令案例

  - **退出命令**：
    - :wq 保存并退出
    - :q! 强制退出不保存更改
    - :q  未修改直接退出
  - 在文件中查找某个单词：**命令行输入 /（查找内容）**，按n查找下一个

  - **设置文件行号：set nu**，取消文件行号：set nonu

  - **编辑文件，正常模式下使用快捷键到达文档最末行：G，最首行：gg**

  - 撤销输入：在正常模式下输入u

  - 编辑文件，**光标移动到某行：shift+g**
    - 显示行号：set nu
    - 输入行号这个数
    - 输入shift+g
  - yy：拷贝当前行
  - 5yy：拷贝当前5行
  - dd：删除当前行
  - 5dd：删除当前行向下的5行

- vim其他命令
  - [参考这个](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/blob/master/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/3.2vi%E5%92%8Cvim%E7%BC%96%E8%BE%91%E5%99%A8.md)

#### 关机、重启Linux

- shutdown
  - shutdown -h now：表示立即关机 （-h halt 直接使用，关机）
  - shutdown -h 1：表示1分钟后关机
  - shutdown -r now：立即重启

- reboot
  - reboot 重启系统

- sync
  - sync：把内存的数据同步到磁盘上

> **当我们关机或者重启时，都应该先执行一下sync，防止数据丢失。**



- 用户登录注销
  - 登录时少用root账号登录，以避免操作失误的损失
  - 平时可登录普通账户，再用“su - 用户名”切换成管理员登录

- logout
  - logout：注销用户

> 在图形运行级别无效，在运行级别3有效。



#### Linux用户管理

- 大致图解

![image-20211202212437185](http://img.codezhou.com/img/image-20211202212437185.png)

- **添加用户**
  - useradd –d /home/sam -m sam
    - 此命令创建了一个用户sam，其中-d和-m选项用来为登录名sam产生一个主目录 /home/sam（/home为默认的用户主目录所在的父目录）。
  - useradd -s /bin/sh -g group –G adm,root gem
    - 新建了一个用户gem，该用户的登录Shell是 /bin/sh，它属于group用户组，同时又属于adm和root用户组，其中group用户组是其主组。
  - -d 目录 指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。
  - -g 用户组 指定用户所属的用户组。

- 用户密码管理
  - 指定和修改用户口令: passwd 选项 用户名

- **删除**用户
  - 删除帐号: userdel 选项 用户名
  - 常用的选项是 -r，它的作用是把用户的主目录一起删除。
    - userdel -r sam
- **修改**用户
  - 修改已有用户的信息: usermod 选项 用户名
- **查询**用户信息
  - 查询用户信息: id 用户名
    - 用户不存在是返回“无此用户”
  - 查看当前用户/登录用户：who am i
- **切换**用户
  - 切换用户：su - 切换用户名
    - 从权限高切换到权限低的用户不需要输密码。
    - 返回切换前的用户：exit

- 用户组的管理

  > 每个用户都有一个用户组，系统可以对一个用户组中的所有用户进行集中管理。不同Linux 系统对用户组的规定有所不同，如Linux下的用户属于与它同名的用户组，这个用户组在创建用户时同时创建。 用户组的管理涉及用户组的添加、删除和修改。组的增加、删除和修改实际上就是对/etc/group文件的更新。

  - 增加一个新的用户组: groupadd 选项 用户组

- 与用户账号有关的系统文件

  - /etc/passwd 文件

    > 用户（user）的配置文件，记录用户的各种信息。

  - etc/shadow 文件

    > 口令配置文件

  - /etc/group 文件

    > 组（group）的配置文件，用户组的所有信息都存放在/etc/group文件中。

### Linux实用指令

#### 七个运行级别

- 0.关机
- 1.单用户【找回丢失密码】
- 2.多用户状态没有网络服务
- 3.多用户状态有网络服务
- 4.系统未使用保留给用户
- 5.图形界面
- 6.系统重启
- 系统的运行级别配置文件：/etc/inittab
- 切换到指定运行级别的指令：init [012356]
  - 如init 0 关机
  - init 5 切换到图形化界面
  - init 3 切换到终端界面

- 帮助指令
  - man [命令或配置文件]
  - help [命令或配置文件]

### 文件目录类指令

#### 文件剪贴删除复制重名

- **pwd**：Print Working Directory，显示当前工作目录的绝对路径。
- ls：-a：显示当前目录所有的文件和目录，包括隐藏的；
  - -l：以列表的方式显示信息。
- cd：cd ~：回到自己的家目录；cd .. ：回到当前目录的上一级目录。
- mkdir：创建目录；-p：创建多级目录。
- rmdir：删除空目录。rmdir不能删除非空的目录。如果需要删除非空的目录，需要使用rm -rf。
- cp：拷贝文件到指定目录；
  - -r：递归复制整个文件夹。
  - 强制覆盖不提示的方法：cp命令改为\cp
- rm：移除文件或目录；
  - -r：递归删除整个文件夹；
  - -f：强制删除不提示。
- mv：移动文件与目录或重命名，两种功能！
  - ![image-20211203145431858](http://img.codezhou.com/img/image-20211203145431858.png)
  - ![image-20211203145452103](http://img.codezhou.com/img/image-20211203145452103.png)
- touch：创建空文件。可以一次性创建多个文件
- ln 给文件创建一个软连接
  - 用法:ln -s 源文件或目录 [软连接名]

#### 文件查看和写入追加文件

- cat：查看文件内容。只能浏览文件，而不能修改文件。
  - -n：显示行号。
  - 结尾加上 | more：分页显示，不会全部一下显示完。
- more：是一个基于VI编辑器的文本过滤器，它以全屏幕的方式按页显示文本文件的内容。more还内置了很多快捷键：
  - 空白键（Space）：向下翻一页
  - Enter：向下翻一行
  - q：立刻离开more，不再显示该文件内容
  - Ctrl + F：向下滚动一屏
  - Ctrl + B：返回上一屏
  - = :输出当前行的行号
  - :f 输出文件名和当前行的行号
- less：用来分屏查看文件内容，与more相似，但是更强大，支持各种显示终端。less指令在显示文件内容时，并不是一次将整个文件加载之后才显示，而是根据显示需要加载内容。对于显示大型文件具有较高的效率。
- head：显示文件的开头部分。-n 5：看前面5行内容。
- tail：输出文件中尾部的内容。
  - -n 5：看后面5行内容。
  - -f：时事追踪该文档的所有更新
- \>指令：输出重定向。如果不存在会创建文件，否则会将原来的文件内容覆盖。
- \>>指令：追加。如果不存在会创建文件，否则不会覆盖原来的文件内容，而是追加到文件的尾部。
- echo：输出内容到控制台。
- history：查看历史指令

#### 时间日期

- date：显示当前日期和时间
  - date “+%Y”：显示当前年份
  - date “+%d”：显示当前月份
  - date “+%Y-%m-%d %H:%M:%S”：显示年-月-日 时：分：秒
  - 设置日期：date -s 字符串时间
- cal：查看日历指令；
  - cal [月] [年份]：显示某一年或月的日历

#### 搜索查找相关命令

- find：从指定目录向下递归的遍历其各个子目录，将满足条件的文件或者目录显示在终端。
  - find (搜索范围) -name (文件名)：按照指定的文件名查找模式查找文件。
  - find (搜索范围) -user (用户名)：按照指定的用户名查找模式查找文件。
  - find (搜索范围) -size (+多少/-多少/多少)：按照指定的文件大小查找模式查找文件（大于多少/小于多少/等于多少）
  - **查询 /目录下所有.txt的文件：find / -name *.txt**
- locate：locate (搜索文件)
  - 可以快速定位文件路径。locate指令利用事先建立的系统中所有文件名称及路径的locate数据库实现快速定位给定的文件。
  - locate指令无需遍历整个文件系统，查询速度较快。为了保证查询结果的准确度，管理员必须定期更新locate时刻。
  - 在第一次运行之前，必须使用updatedb指令创建locate数据库。
- grep：**过滤查找，表示将前一个命令的处理结果输出传递给后面的命令处理。经常跟管道一起使用。**
  - grep [选项] 查找内容 源文件
  - -n：显示匹配行及行号。
  - -i：忽略大小写字母。
  - cat hello.txt | grep yes

#### 压缩和解压类

- gzip/gunzip：压缩文件/解压
  - gzip (文件)：压缩为.gz文件，原来文件不保留。
  - gunzip (文件)：解压缩，同样也不保留源文件。
- zip/unzip：压缩文件/解压
  - zip [选项] (压缩后文件xxx.zip) (将要压缩的文件)
  - unzip [选项] (要解压的文件xxx.zip)
  - zip -r：递归压缩，即压缩目录
  - unzip -d (目录)：指定解压后的文件的存放目录
- tar：打包指令，最后打包后的文件是.tar.gz的文件
  - tar [选项] xxx.tar.gz (打包的内容)
  - -c：产生.tar打包文件
  - -v：显示详细信息
  - -f：指定压缩后的文件名
  - -z：打包同时压缩
  - -x：解压.tar文件
  - **压缩：tar -zcvf (压缩后文件名) (要压缩的文件)**
  - **解压：tar -zxvf (要解压的文件)**
  - **解压到指定目录：tar -zxvf (要解压的文件) -C (指定目录)，指定解压到的目录要存在。**

### Linux权限管理

#### 组基本介绍

- Linux中每个用户属于一个组，不能独立于组以外。所以在Linux中每个文件存在组的概念：
  1. 所有者
  2. 所在组
  3. 其他组
  4. 改变用户所在组

#### 文件/目录所有者/组

- 查看文件所有者：ls -ahl
- 修改文件所有者：chown (用户名) (文件名)
- 修改文件所在组：chgrp (组名) (文件名)

#### 文件属性

![3.6文件属性.jpg](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/raw/master/imgs/3/3.6文件属性.jpg)

- 在Linux中第一个字符代表这个文件是目录、文件或链接文件等等。
  - 当为[ **d** ]则是目录
  - 当为[ - ]则是文件；
  - 若是[ l ]则表示为链接文档(link file)；
  - 若是[ b ]则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；
  - 若是[ c ]则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。
- 接下来的字符中，以三个为一组，且均为『rwx』 的三个参数的组合。[ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号[ - ]而已。

![文件权限](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/raw/master/imgs/3/3.6文件权限.png)

- **rwx权限详解**
  - rwx作用到**文件**：
    - r：read，可读。读取查看。
    - w：write，可以修改。但不代表可以删除该文件。删除一个文件的前提条件是对该文件所在的目录有写权限，才能删除该文件。
    - x：execute，可执行。可以被执行。
  - rwx作用到**目录**：
    - r：可以读取，ls查看目录内容。
    - w：可以修改，目录内创建+删除+重命名目录。
    - x：可执行，可以进入该目录。
  - 我们可以使用数字来代表各个权限，各权限的分数对照表如下：
    - r:4
    - w:2
    - x:1

#### 修改权限

- **chgrp：更改文件属组**
  - chgrp [-R] 属组名 文件名
    - -R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。

- **chown：更改文件属主，也可以同时更改文件属组**
  - chown [–R] 属主名 文件名
  - chown [-R] 属主名：属组名 文件名

- **chmod：更改文件9个权限属性**
  - **使用数字修改权限：**
    - **如更改a.txt权限为 rwxr-xr-- 可以写为 chmod 754  a.txt**

### 定时任务调度

- crond任务调度：crontab进行定时任务调度

  ![3.7定时调度原理](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/raw/master/imgs/3/3.7定时调度原理.jpg)

- [详情](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/blob/master/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/3.7%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6.md)

### Linux磁盘分区、挂载度

- 分区方式
  - mbr分区
    - 最多支持四个主分区
    - 系统只能安装在主分区
    - 扩展分区要占一个主分区
    - MBR最大只支持2TB，但拥有最好的兼容性
  - gpt分区
    - 支持无限多个主分区（但操作系统可能限制，比如windows下最多128个分区）
    - 最大支持18EB的大容量（1EB=1024PB，PB=1024TB）
    - windows7 64位以后支持gpt

- 目前用处不大，以后自己在家搭一个Linux服务器的时候可能需要了解下



### 进程管理

#### ps指令详细介绍

> ps [选项]：查看目前系统中，有哪些正在执行，以及它们执行的状况

- ps -a：显示当前终端的所有进程信息。
- ps -u：以用户的格式显示进程信息。
- ps -x：显示后台进程运行的参数。
- ps -axu | grep xxx：过滤得到xxx的信息。
- ps -ef：以全格式显示当前所有的进程，查看进程的父进程。
- -e：显示所有进程。
- -f：全格式。

> ps -axu显示信息选项

![img](http://img.codezhou.com/img/YYHM`0M1ZWJ[{EPC78]LT$K.png)

#### 终止进程

> 若是某个进程执行一半需要停止时，或是消耗了很大的系统资源时，此时可以考虑停止该进程，使用kill命令来完成此任务

- kill [选项] 进程号：通过进程号杀死进程
  - -9：表示强迫进程立刻停止
- killall 进程名称：通过进程名称杀死进程，也支持通配符，这在系统因负载过大而变得很慢时很有用

#### 服务(Service)管理

> 服务(Service)本质就是进程，但是是运行在后台的，通常都会监听某个端口，等待其它程序的请求，比如(mysql,sshd 防火墙等),因此我们又称为守护进程。

#### service管理指令

- service管理指令：service 服务名 [start | stop | restart | reload | status]
  - **service iptables status**
-  **在CentOS7.0之后，不再使用service**，而是**systemctl**
  - **systemctl status iptables**
  - systemctl start iptables

#### 服务的运行级别

- **开机流程**

![img](http://img.codezhou.com/img/LGP0VG@DYEY%CX%V_0%ZKG9.png)

- **chkconfig指令**

> chkconfig：可以给每个服务的各个运行级别设置自启动/关闭

- **基本语法**
  - 查看xxx服务：chkconfig –list | grep xxx
  - 查看服务的状态：chkconfig 服务名 --list
  - 给服务的运行级别设置自启动：chkconfig –level 5 服务名 on/off
  - 要所有运行级别关闭或开启：chkconfig 服务名 on/off
  - **chkconfig重新设置后需要重新启动才能生效**

#### 动态监控进程

> top与ps相似，都是用来显示正在执行的进程，top的不同之处在于top执行一段时间可以更新正在运行的进程

- **基本语法**

> top [选项]
>
> - -d 秒数：指定top命令每隔几秒更新。默认是3秒。
> - -i：使top不显示任何闲置或者僵死进程。
> - -p：通过指定监控进程ID来仅仅监控某个进程的状态。



### 包管理工具

#### RPM包

> RPM：RedHat Package Manager，红帽软件包管理工具。 Linuxd分发版本都有采用（suse,redhat，centos等）

RPM查询已安装的rpm列表：rpm -qa | grep xx

- 查看是否安装firefox：rpm -qa |grep firefox

![3.11rpm查询结果.jpg](https://github.com/Sunxz007/Linux-note-follow-Hanshunping/raw/master/imgs/3/3.11rpm%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C.jpg)

#### 卸载/安装指令

- 卸载rpm包：rpm -e 软件包名称

- 安装rpm包：rpm -ivh 软件包全路径名称
  - i=install：安装
  - v=verbose：提示
  - h=hash：进度条

#### YUM

> um（ Yellow dog Updater, Modified）是一个在Fedora和RedHat以及SUSE中的Shell前端软件包管理器。 基於RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软体包，无须繁琐地一次次下载、安装。

- yum list | grep xx：查询yum服务器是否有需要安装的软件
- **yum install xx：安装指定的yum包**
- yum -y remove xx：卸载指定的yum包